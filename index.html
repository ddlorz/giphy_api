<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <title>GIF Ajax</title>
  <link rel="stylesheet" href="assets/css/reset.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Francois+One" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    body {
      font-family: 'Francois One', sans-serif;
      background-color: #f2f2f2;
    }
    footer {
      min-height: 50px;
    }
    .embeddedmp4 {
      max-height: 250px;
      max-width: 250px;
      border: 2px inset #bfbfbf;
      border-radius: 15px;
      opacity: 0.5;
    }
    .videos {
      min-height: 220px;
      min-width: 250px;
      display: inline-block;
      margin: 0 5px 0 5px;  
    }
    .tags {
      margin: 0 5px 0 5px;
    }
    .animatedImg {
      height: 150px;
      width: auto;
      border-radius: 10px;
      position: relative;
      right: 25%;
    }
    .grayBG {
      background-color: #cccccc;
      padding-top: 20px;
      padding-bottom: 20px;
      border-radius: 20px;
    }
    .labels {
      margin-top: 50px;
      font-size: 20pt;
    }    
    #buttonSide {
      margin-bottom: 50px;
    }
    #searchBarSide {
      margin: 50px 0 50px 0;
    }   
    #spacer {
      min-height: 120px;
    }

  </style>
</head>

<body>
  <div class="text-center labels">Animal Tags</div>
  <div class="container text-center grayBG" id="buttonSide"></div>
  <div class="container">
    <div class="text-center" style="font-size: 20pt;">Sliding Animal</div>    
    <div class="row text-center grayBG" id="animateSide"></div>
    <div class="row" id="searchBarSide">
      <form class="text-center">
        <label for="Animal" id="formLabel"></label>
        <input type="text" id="gifTag">
        <input type="submit" class="btn btn-default" id="submit">
      </form>
    </div>
    <div class="row text-center">
      <div class="col-lg-12 grayBG" id="gifSide"></div>
    </div>
  </div>
  <div id="spacer"></div>
  <footer class="footer">
      <h5 class="text-center">Â©Copyright 2017 Domingo Loria</h5>  
  </footer>

  <script  src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
  <script type="text/javascript">
  //<script type="text/javascript" src="assets/javascript/app.js">
    var gifObject = {
      inputTag: "dog",
      inputTagArray: [],
      indexCounter: [],

      createNewVid: function(mp4Location) {
        var newVid = $("<video>");
        newVid.attr("loop", "loop");
        newVid.attr("type", "video/mp4");        
        newVid.attr("src", mp4Location);
        newVid.val("notRunning");
        newVid.addClass("embeddedmp4");
        return newVid;
      },

      createNewImg: function(imgLocation) {
        var newImg = $("<img>");
        newImg.attr("src",imgLocation);
        newImg.addClass("animatedImg");
        return newImg;
      },

      createNewDiv: function(ratingLocation) {
        var newDiv = $("<div>");          
        newDiv.addClass("videos");
        newDiv.html("Rating: " + ratingLocation + "<br>");
        return newDiv;
      },

      createNewBtn: function(inputTag) {
        var newBtn = $("<button>");
        newBtn.addClass("btn btn-default tags");
        newBtn.html(inputTag.toUpperCase());
        return newBtn;
      },

      motionControl: function(theElement) {
        if ($(theElement).val() === "running") {
          $(theElement).get(0).pause();
          $(theElement).animate({
            opacity: 0.5
          }, 1000, function() {});
          $(theElement).val("notRunning")
        } 
        else if ($(theElement).val() === "notRunning"){
          $(theElement).get(0).play();   
          $(theElement).animate({
            opacity: 1.0
          }, 1000, function() {});       
          $(theElement).val("running")
        }
      },

      clearOut: function(event) {
        gifObject.indexCounter = [];
        event.preventDefault();
        $("#gifSide").empty();        
      },

      pullANDdisplayGIFs: function(inputTag) {
        $.ajax({
          url: "https://api.giphy.com/v1/gifs/search?q=" + inputTag + "&api_key=dc6zaTOxFJmzC",
          type: "GET",
          success: function(response) {
            
            if (response.data.length > 0) {
              console.log(response);
              var counter = 0;
              var i = 0;
              while (counter < 10) {
                if (parseInt(response.data[i].images.original.height) < 300) {
                  var mp4Location = response.data[i].images.original.mp4;
                  var ratingLocation = response.data[i].rating;          
                  
                  var newDiv = gifObject.createNewDiv(ratingLocation)
                  var newVid = gifObject.createNewVid(mp4Location);
                  gifObject.indexCounter.push(i);

                  newDiv.append(newVid);
                  $("#gifSide").append(newDiv);    
                  counter++;
                }
                i++;                
              }                  
              animatedGIFs(response);          
              
              if (gifObject.inputTagArray.indexOf(inputTag.toUpperCase()) === -1) {
                  var newBtn = gifObject.createNewBtn(inputTag);
                  $("#buttonSide").append(newBtn);
                  gifObject.inputTagArray.push(inputTag.toUpperCase());
              }
            }
            else if (response.data.length === 0) {
              $("#gifSide").append("Search Failed. Try Again");
            }
          }
        });
      },

      displayAnimation: function(i, anObject) {
            var imgLocation = anObject.data[gifObject.indexCounter[i]].images.downsized.url;
            //console.log(anObject.data[gifObject.inputTagArray[i]].images.downsized_still.url);
            var newImg = gifObject.createNewImg(imgLocation);

            newImg.css("opacity", "1.0");
            //newImg.css("position", "relative");
            $("#animateSide").html(newImg);
            newImg.animate({
                  opacity: 0,
                  left: "+=50%"
            }, 10000, function() {}); 
      },

    };   

    var timed;
    
    gifObject.pullANDdisplayGIFs(gifObject.inputTag);
    $("#formLabel").html("Enter an Animal: ");        

    function animatedGIFs(anObject) {
          var i = Math.floor(Math.random() * 10);
          gifObject.displayAnimation(i, anObject); 

          console.log(i);              
          
          timed = setInterval(function() {
              i = Math.floor(Math.random() * 10);
              gifObject.displayAnimation(i, anObject);                           
          }, 10000);
    };


    $("div").on("click", "video", function(event) {
          gifObject.motionControl(this);  
          event.stopImmediatePropagation();
    });

    $("#submit").on("click", function(event) {
          gifObject.clearOut(event);
          var inputTag = $("#gifTag").val();
          $("#gifTag").val("");      
          console.log(inputTag);
          clearTimeout(timed);          
          
          gifObject.pullANDdisplayGIFs(inputTag);
    });  

    $("div").on("click", "button.tags", function() {
          gifObject.clearOut();

          var inputTag = $(this).text();
          console.log(inputTag);

          gifObject.pullANDdisplayGIFs(inputTag);  
    }); 
    
  </script>

</body>
</html>